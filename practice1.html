<!DOCTYPE html>
<html>
<head>
  <title>D3 Application</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    #tooltip {
      /* ... existing styles ... */
    }
  </style>
</head>
<body>
  <h1>Year on Year trend of Total Obesity in the US</h1>
  <button id="addButton">Add Year</button>
  <button id="removeButton">Remove Year</button>
  <div id="chart"></div>
  <div id="tooltip"></div>

  <script>
    var originalData = [
      /* ... original data ... */
    ];

    var removedYears = [];
    var data = originalData.slice();

    /* ... existing SVG, scale, and line setup ... */

    var addButton = d3.select("#addButton");
    addButton.on("click", handleAddButtonClick);

    var removeButton = d3.select("#removeButton");
    removeButton.on("click", handleRemoveButtonClick);

    function handleAddButtonClick() {
      if (removedYears.length > 0) {
        var yearToAdd = removedYears.pop();
        var yearData = originalData.find(d => d.year === yearToAdd);
        data.push(yearData);
        data.sort((a, b) => a.year - b.year); // Sort data by year after adding

        updateChart();
      }
    }

    function handleRemoveButtonClick() {
      if (data.length > 1) {
        var yearToRemove = data[data.length - 1].year;
        removedYears.push(yearToRemove);
        data = data.filter(d => d.year !== yearToRemove); // Remove the last year correctly

        updateChart();
      }
    }

    function updateChart() {
      // Update domains
      xScale.domain([d3.min(data, d => d.year), d3.max(data, d => d.year)]);
      yScale.domain([0, d3.max(data, d => Math.max(d.value, d.value1 || 0, d.value2 || 0))]);

      // Update paths
      svg.select("path.value").datum(data).attr("d", line);
      svg.select("path.value1").datum(data).attr("d", line1);
      svg.select("path.value2").datum(data).attr("d", line2);

      // Update circles
      updateCircles("circle.value", d => d.value);
      updateCircles("circle.value1", d => d.value1);
      updateCircles("circle.value2", d => d.value2);

      // Update axes
      svg.select(".x-axis")
         .transition()
         .call(d3.axisBottom(xScale).ticks(10).tickFormat(d3.format("d")));

      svg.select(".y-axis")
         .transition()
         .call(d3.axisLeft(yScale));
    }

    function updateCircles(selector, valueAccessor) {
      var updatedCircles = svg.selectAll(selector)
                              .data(data, d => d.year);

      updatedCircles.exit().remove();

      updatedCircles.enter()
                    .append("circle")
                    .attr("class", selector.replace('.', ''))
                    .attr("r", 5)
                    .attr("fill", selector === "circle.value" ? "steelblue" : (selector === "circle.value1" ? "green" : "red"))
                    .merge(updatedCircles)
                    .filter(d => valueAccessor(d) != null) // Filter for null values
                    .transition()
                    .duration(500)
                    .attr("cx", d => xScale(d.year))
                    .attr("cy", d => yScale(valueAccessor(d)));

      updatedCircles.on("mouseover", handleMouseOver)
                    .on("mouseout", handleMouseOut);
    }

    /* ... other existing functions ... */

  </script>
</body>
</html>
